<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±‰ä¸­æ—…æ¸¸ç½‘ç«™ - é—®é¢˜ä¿®å¤æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #28a745;
        }
        
        .status-card.warning {
            border-left-color: #ffc107;
        }
        
        .status-card.error {
            border-left-color: #dc3545;
        }
        
        .status-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .status-card p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-fixed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-testing {
            background: #fff3cd;
            color: #856404;
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .test-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .test-result {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .test-result h4 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .test-result pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .quick-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        
        .quick-link {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .quick-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            color: white;
        }
        
        .quick-link h4 {
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .quick-link p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .user-status {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .user-status h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .favorites-count {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .favorites-count h4 {
            color: #f57c00;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .test-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›ï¸ æ±‰ä¸­æ—…æ¸¸ç½‘ç«™é—®é¢˜ä¿®å¤æµ‹è¯•</h1>
            <p>éªŒè¯æ”¶è—åŠŸèƒ½å’Œé€€å‡ºç™»å½•é‡ç½®åŠŸèƒ½çš„ä¿®å¤æ•ˆæœ</p>
        </div>

        <!-- ä¿®å¤çŠ¶æ€å±•ç¤º -->
        <div class="status-grid">
            <div class="status-card">
                <h3>1. æ™¯ç‚¹è¯¦æƒ…å¼¹çª—æ˜¾ç¤ºé—®é¢˜ <span class="status-indicator status-fixed">âœ… å·²ä¿®å¤</span></h3>
                <p>â€¢ å¼¹çª—é«˜åº¦è°ƒæ•´ä¸º80vhï¼Œç¡®ä¿å…³é—­å’Œæ”¶è—æŒ‰é’®å¯è§</p>
                <p>â€¢ ä½¿ç”¨flexå¸ƒå±€ä¼˜åŒ–å¼¹çª—ç»“æ„</p>
                <p>â€¢ æ”¯æŒç§»åŠ¨ç«¯å“åº”å¼æ˜¾ç¤º</p>
            </div>

            <div class="status-card">
                <h3>2. æ”¶è—åŠŸèƒ½ç»Ÿä¸€ä¿®å¤ <span class="status-indicator status-fixed">âœ… å·²ä¿®å¤</span></h3>
                <p>â€¢ ç»Ÿä¸€ä½¿ç”¨hanzhong_favoriteså­˜å‚¨é”®</p>
                <p>â€¢ ä¿®å¤æ™¯ç‚¹ã€ç¾é£Ÿã€æ±‰æ–‡åŒ–æ”¶è—åŠŸèƒ½</p>
                <p>â€¢ æ”¶è—çŠ¶æ€æ­£ç¡®åŒæ­¥åˆ°æ”¶è—å¤¹</p>
                <p>â€¢ æ”¯æŒç™»å½•çŠ¶æ€æ£€æŸ¥å’ŒæŒ‰é’®çŠ¶æ€æ›´æ–°</p>
            </div>

            <div class="status-card">
                <h3>3. æ±‰æ–‡åŒ–é¢„è®¢å¼¹çª—å¸ƒå±€ <span class="status-indicator status-fixed">âœ… å·²ä¿®å¤</span></h3>
                <p>â€¢ å¸ƒå±€æ”¹ä¸ºä¸Šä¸‹æ’åˆ—ï¼Œæ›´åŠ ç¾è§‚</p>
                <p>â€¢ é‡‡ç”¨å¡ç‰‡å¼è®¾è®¡</p>
                <p>â€¢ ä¼˜åŒ–è§†è§‰æ•ˆæœå’Œç”¨æˆ·ä½“éªŒ</p>
            </div>

            <div class="status-card">
                <h3>4. é€€å‡ºç™»å½•é‡ç½®åŠŸèƒ½ <span class="status-indicator status-fixed">âœ… å·²ä¿®å¤</span></h3>
                <p>â€¢ é€€å‡ºç™»å½•æ—¶æ¸…ç©ºæ”¶è—æ•°æ®</p>
                <p>â€¢ é‡ç½®æ‰€æœ‰æ”¶è—æŒ‰é’®çŠ¶æ€</p>
                <p>â€¢ é¡µé¢åˆ‡æ¢æ—¶çŠ¶æ€ä¿æŒæ­£ç¡®</p>
                <p>â€¢ ç”¨æˆ·æœªç™»å½•æ—¶æŒ‰é’®æ˜¾ç¤º"æ”¶è—"</p>
            </div>
        </div>

        <!-- ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º -->
        <div class="user-status">
            <h4>å½“å‰ç”¨æˆ·çŠ¶æ€</h4>
            <p id="userStatusText">æ£€æŸ¥ä¸­...</p>
        </div>

        <!-- æ”¶è—æ•°é‡æ˜¾ç¤º -->
        <div class="favorites-count">
            <h4>æ”¶è—æ•°æ®ç»Ÿè®¡</h4>
            <p id="favoritesCountText">ç»Ÿè®¡ä¸­...</p>
        </div>

        <!-- æ”¶è—åŠŸèƒ½æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”– æ”¶è—åŠŸèƒ½æµ‹è¯•å·¥å…·</h2>
            <div class="test-buttons">
                <button class="btn btn-success" onclick="simulateLogin()">æ¨¡æ‹Ÿç™»å½•</button>
                <button class="btn btn-warning" onclick="simulateLogout()">æ¨¡æ‹Ÿé€€å‡ºç™»å½•</button>
                <button class="btn btn-info" onclick="addTestFavorites()">æ·»åŠ æµ‹è¯•æ”¶è—æ•°æ®</button>
                <button class="btn btn-primary" onclick="checkFavoritesStatus()">æ£€æŸ¥æ”¶è—çŠ¶æ€</button>
                <button class="btn btn-danger" onclick="clearAllFavorites()">æ¸…ç©ºæ‰€æœ‰æ”¶è—</button>
                <button class="test-btn" onclick="testFavoriteFunction()">æµ‹è¯•æ”¶è—åŠŸèƒ½</button>
                <button class="test-btn" onclick="testPageNavigation()">æµ‹è¯•é¡µé¢è·³è½¬</button>
                <button class="test-btn" onclick="refreshCurrentPage()">åˆ·æ–°é¡µé¢</button>
            </div>
            
            <div class="test-result">
                <h4>æµ‹è¯•ç»“æœï¼š</h4>
                <pre id="testResult">ç­‰å¾…æµ‹è¯•æ“ä½œ...</pre>
            </div>
        </div>

        <!-- é¡µé¢è·³è½¬æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”„ é¡µé¢è·³è½¬æµ‹è¯•</h2>
            <p>æµ‹è¯•åœ¨ä¸åŒé¡µé¢é—´åˆ‡æ¢æ—¶æ”¶è—çŠ¶æ€æ˜¯å¦æ­£ç¡®ä¿æŒ</p>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testPageNavigation()">å¼€å§‹é¡µé¢è·³è½¬æµ‹è¯•</button>
                <button class="btn btn-info" onclick="refreshCurrentPage()">åˆ·æ–°å½“å‰é¡µé¢</button>
            </div>
        </div>

        <!-- å¿«é€Ÿè®¿é—®é“¾æ¥ -->
        <div class="quick-links">
            <a href="jingdian.html" class="quick-link">
                <h4>ğŸ”ï¸ æ™¯ç‚¹ä»‹ç»</h4>
                <p>æµ‹è¯•æ™¯ç‚¹æ”¶è—åŠŸèƒ½</p>
            </a>
            <a href="meishi.html" class="quick-link">
                <h4>ğŸœ ç¾é£Ÿæ¨è</h4>
                <p>æµ‹è¯•ç¾é£Ÿæ”¶è—åŠŸèƒ½</p>
            </a>
            <a href="wenhua.html" class="quick-link">
                <h4>ğŸ›ï¸ æ±‰æ–‡åŒ–æ´»åŠ¨</h4>
                <p>æµ‹è¯•æ–‡åŒ–æ”¶è—åŠŸèƒ½</p>
            </a>
            <a href="index.html" class="quick-link">
                <h4>ğŸ  è¿”å›é¦–é¡µ</h4>
                <p>å›åˆ°ç½‘ç«™é¦–é¡µ</p>
            </a>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateUserStatus();
            updateFavoritesCount();
            
            // å®šæœŸæ›´æ–°çŠ¶æ€
            setInterval(() => {
                updateUserStatus();
                updateFavoritesCount();
            }, 2000);
        });

        // æ›´æ–°ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º
        function updateUserStatus() {
            const userData = getGlobalUserData();
            const statusText = document.getElementById('userStatusText');
            
            if (userData) {
                statusText.innerHTML = `
                    âœ… å·²ç™»å½•ç”¨æˆ·ï¼š${userData.username || userData.email || 'æœªçŸ¥ç”¨æˆ·'}<br>
                    ç™»å½•æ—¶é—´ï¼š${userData.loginTime ? new Date(userData.loginTime).toLocaleString() : 'æœªçŸ¥'}
                `;
            } else {
                statusText.innerHTML = 'âŒ æœªç™»å½•çŠ¶æ€';
            }
        }

        // æ›´æ–°æ”¶è—æ•°é‡æ˜¾ç¤º
        function updateFavoritesCount() {
            const favorites = JSON.parse(localStorage.getItem('hanzhong_favorites') || '[]');
            const countText = document.getElementById('favoritesCountText');
            
            const attractionCount = favorites.filter(fav => fav.type === 'attraction').length;
            const foodCount = favorites.filter(fav => fav.type === 'food').length;
            const cultureCount = favorites.filter(fav => fav.type === 'culture').length;
            
            countText.innerHTML = `
                æ€»æ”¶è—æ•°ï¼š${favorites.length} é¡¹<br>
                æ™¯ç‚¹ï¼š${attractionCount} ä¸ª | ç¾é£Ÿï¼š${foodCount} ä¸ª | æ–‡åŒ–ï¼š${cultureCount} ä¸ª
            `;
        }

        // æ¨¡æ‹Ÿç™»å½•
        function simulateLogin() {
            const userData = {
                username: 'testuser',
                email: 'test@example.com',
                loginTime: new Date().toISOString()
            };
            
            localStorage.setItem('hanzhong_user', JSON.stringify(userData));
            updateTestResult('âœ… æ¨¡æ‹Ÿç™»å½•æˆåŠŸï¼ç”¨æˆ·æ•°æ®å·²ä¿å­˜ã€‚');
            updateUserStatus();
            
            // æ›´æ–°æ‰€æœ‰æ”¶è—æŒ‰é’®çŠ¶æ€
            if (typeof updateAllFavoriteButtonsStatus === 'function') {
                updateAllFavoriteButtonsStatus();
            }
        }

        // æ¨¡æ‹Ÿé€€å‡ºç™»å½•
        function simulateLogout() {
            // è°ƒç”¨å…¨å±€é€€å‡ºç™»å½•å‡½æ•°
            if (typeof performLogout === 'function') {
                performLogout();
                updateTestResult('âœ… æ¨¡æ‹Ÿé€€å‡ºç™»å½•æˆåŠŸï¼ç”¨æˆ·æ•°æ®å’Œæ”¶è—æ•°æ®å·²æ¸…ç©ºã€‚');
            } else {
                // æ‰‹åŠ¨æ¸…ç†
                localStorage.removeItem('hanzhong_user');
                localStorage.removeItem('hanzhong_favorites');
                updateTestResult('âœ… æ‰‹åŠ¨é€€å‡ºç™»å½•æˆåŠŸï¼æ•°æ®å·²æ¸…ç©ºã€‚');
            }
            
            updateUserStatus();
            updateFavoritesCount();
        }

        // æ·»åŠ æµ‹è¯•æ”¶è—æ•°æ®
        function addTestFavorites() {
            const testFavorites = [
                {
                    id: 'zhuyu-liyuan',
                    type: 'attraction',
                    title: 'æœ±é¹®æ¢¨å›­',
                    description: 'ä¸–ç•Œæœ±é¹®ä¹‹ä¹¡ï¼Œä¸‡äº©æ¢¨èŠ±æµ·æ´‹',
                    image: 'img/zhuyu-liyuan.jpg',
                    rating: 4.8,
                    price: 'ï¿¥60',
                    url: 'jingdian.html#attraction-zhuyu-liyuan',
                    addTime: new Date().toISOString()
                },
                {
                    id: 'remenpi',
                    type: 'food',
                    title: 'æ±‰ä¸­çƒ­é¢çš®',
                    description: 'æ±‰ä¸­æœ€å…·ä»£è¡¨æ€§çš„ç‰¹è‰²å°åƒ',
                    image: 'img/remenpi.jpg',
                    rating: 4.9,
                    price: 'ï¿¥5-8',
                    url: 'meishi.html#food-remenpi',
                    addTime: new Date().toISOString()
                },
                {
                    id: 'hanfu-experience',
                    type: 'culture',
                    title: 'æ±‰æœæ–‡åŒ–ä½“éªŒ',
                    description: 'ç©¿è¶Šæ—¶ç©ºï¼Œæ„Ÿå—æ±‰ä»£æœé¥°æ–‡åŒ–',
                    image: 'img/hanfu.jpg',
                    rating: 4.7,
                    price: 'ï¿¥128',
                    url: 'wenhua.html#culture-hanfu-experience',
                    addTime: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('hanzhong_favorites', JSON.stringify(testFavorites));
            updateTestResult('âœ… æµ‹è¯•æ”¶è—æ•°æ®æ·»åŠ æˆåŠŸï¼åŒ…å«æ™¯ç‚¹ã€ç¾é£Ÿã€æ–‡åŒ–å„1é¡¹ã€‚');
            updateFavoritesCount();
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            if (typeof updateAllFavoriteButtonsStatus === 'function') {
                updateAllFavoriteButtonsStatus();
            }
        }

        // æ£€æŸ¥æ”¶è—çŠ¶æ€
        function checkFavoritesStatus() {
            const favorites = JSON.parse(localStorage.getItem('hanzhong_favorites') || '[]');
            const userData = getGlobalUserData();
            
            let result = `æ”¶è—çŠ¶æ€æ£€æŸ¥ç»“æœï¼š\n`;
            result += `ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼š${userData ? 'å·²ç™»å½•' : 'æœªç™»å½•'}\n`;
            result += `æ”¶è—æ•°æ®æ€»æ•°ï¼š${favorites.length}\n\n`;
            
            if (favorites.length > 0) {
                result += `æ”¶è—è¯¦æƒ…ï¼š\n`;
                favorites.forEach((fav, index) => {
                    result += `${index + 1}. [${fav.type}] ${fav.title}\n`;
                    result += `   æ·»åŠ æ—¶é—´ï¼š${new Date(fav.addTime).toLocaleString()}\n`;
                });
            } else {
                result += `æš‚æ— æ”¶è—æ•°æ®\n`;
            }
            
            updateTestResult(result);
        }

        // æ¸…ç©ºæ‰€æœ‰æ”¶è—
        function clearAllFavorites() {
            localStorage.removeItem('hanzhong_favorites');
            updateTestResult('âœ… æ‰€æœ‰æ”¶è—æ•°æ®å·²æ¸…ç©ºï¼');
            updateFavoritesCount();
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            if (typeof updateAllFavoriteButtonsStatus === 'function') {
                updateAllFavoriteButtonsStatus();
            }
        }

        // æµ‹è¯•é¡µé¢è·³è½¬
        function testPageNavigation() {
            updateTestResult('ğŸ”„ å¼€å§‹é¡µé¢è·³è½¬æµ‹è¯•...\nè¯·æ‰‹åŠ¨è®¿é—®å„ä¸ªé¡µé¢ï¼Œè§‚å¯Ÿæ”¶è—æŒ‰é’®çŠ¶æ€æ˜¯å¦æ­£ç¡®ã€‚');
        }

        // åˆ·æ–°å½“å‰é¡µé¢
        function refreshCurrentPage() {
            window.location.reload();
        }

        // æ›´æ–°æµ‹è¯•ç»“æœæ˜¾ç¤º
        function updateTestResult(result) {
            document.getElementById('testResult').textContent = result;
        }

        // æµ‹è¯•æ”¶è—åŠŸèƒ½
        function testFavoriteFunction() {
            const userData = getGlobalUserData();
            if (!userData) {
                updateTestResult('âŒ è¯·å…ˆæ¨¡æ‹Ÿç™»å½•å†æµ‹è¯•æ”¶è—åŠŸèƒ½');
                return;
            }

            // æµ‹è¯•æ·»åŠ æ”¶è—
            const testItem = {
                id: 'test-item',
                type: 'attraction',
                title: 'æµ‹è¯•æ™¯ç‚¹',
                description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ™¯ç‚¹',
                image: 'img/default-image.jpg',
                rating: 4.5,
                price: 'ï¿¥50',
                url: 'test.html',
                addTime: new Date().toISOString()
            };

            // æ·»åŠ æ”¶è—
            let favorites = JSON.parse(localStorage.getItem('hanzhong_favorites') || '[]');
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
            const existingIndex = favorites.findIndex(fav => fav.id === testItem.id && fav.type === testItem.type);
            
            if (existingIndex === -1) {
                favorites.push(testItem);
                localStorage.setItem('hanzhong_favorites', JSON.stringify(favorites));
                updateTestResult('âœ… æ”¶è—åŠŸèƒ½æµ‹è¯•æˆåŠŸï¼å·²æ·»åŠ æµ‹è¯•æ™¯ç‚¹åˆ°æ”¶è—å¤¹ã€‚\n\nç°åœ¨å¯ä»¥ç‚¹å‡»æ”¶è—å¤¹æŒ‰é’®æŸ¥çœ‹æ”¶è—å†…å®¹ã€‚');
            } else {
                // ç§»é™¤æµ‹è¯•é¡¹
                favorites.splice(existingIndex, 1);
                localStorage.setItem('hanzhong_favorites', JSON.stringify(favorites));
                updateTestResult('âœ… æ”¶è—åŠŸèƒ½æµ‹è¯•æˆåŠŸï¼å·²ç§»é™¤æµ‹è¯•æ™¯ç‚¹ã€‚');
            }
            
            updateFavoritesCount();
            
            // å¦‚æœå­˜åœ¨å…¨å±€æ›´æ–°æŒ‰é’®çŠ¶æ€çš„å‡½æ•°ï¼Œåˆ™è°ƒç”¨
            if (typeof updateAllFavoriteButtonsStatus === 'function') {
                updateAllFavoriteButtonsStatus();
            }
        }

        // è·å–ç”¨æˆ·æ•°æ®çš„å…¼å®¹å‡½æ•°
        function getGlobalUserData() {
            if (typeof window.getGlobalUserData === 'function') {
                return window.getGlobalUserData();
            }
            
            try {
                const userData = localStorage.getItem('hanzhong_user');
                return userData ? JSON.parse(userData) : null;
            } catch (e) {
                return null;
            }
        }
    </script>
</body>
</html> 