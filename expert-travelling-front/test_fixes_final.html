<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>汉中旅游网站 - 问题修复测试</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid #28a745;
        }
        
        .status-card.warning {
            border-left-color: #ffc107;
        }
        
        .status-card.error {
            border-left-color: #dc3545;
        }
        
        .status-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .status-card p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-fixed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-testing {
            background: #fff3cd;
            color: #856404;
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .test-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .test-result {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e0e0e0;
        }
        
        .test-result h4 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .test-result pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .quick-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        
        .quick-link {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .quick-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            color: white;
        }
        
        .quick-link h4 {
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .quick-link p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .user-status {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .user-status h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .favorites-count {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .favorites-count h4 {
            color: #f57c00;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .status-grid {
                grid-template-columns: 1fr;
            }
            
            .test-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏛️ 汉中旅游网站问题修复测试</h1>
            <p>验证收藏功能和退出登录重置功能的修复效果</p>
        </div>

        <!-- 修复状态展示 -->
        <div class="status-grid">
            <div class="status-card">
                <h3>1. 景点详情弹窗显示问题 <span class="status-indicator status-fixed">✅ 已修复</span></h3>
                <p>• 弹窗高度调整为80vh，确保关闭和收藏按钮可见</p>
                <p>• 使用flex布局优化弹窗结构</p>
                <p>• 支持移动端响应式显示</p>
            </div>

            <div class="status-card">
                <h3>2. 收藏功能统一修复 <span class="status-indicator status-fixed">✅ 已修复</span></h3>
                <p>• 统一使用hanzhong_favorites存储键</p>
                <p>• 修复景点、美食、汉文化收藏功能</p>
                <p>• 收藏状态正确同步到收藏夹</p>
                <p>• 支持登录状态检查和按钮状态更新</p>
            </div>

            <div class="status-card">
                <h3>3. 汉文化预订弹窗布局 <span class="status-indicator status-fixed">✅ 已修复</span></h3>
                <p>• 布局改为上下排列，更加美观</p>
                <p>• 采用卡片式设计</p>
                <p>• 优化视觉效果和用户体验</p>
            </div>

            <div class="status-card">
                <h3>4. 退出登录重置功能 <span class="status-indicator status-fixed">✅ 已修复</span></h3>
                <p>• 退出登录时清空收藏数据</p>
                <p>• 重置所有收藏按钮状态</p>
                <p>• 页面切换时状态保持正确</p>
                <p>• 用户未登录时按钮显示"收藏"</p>
            </div>
        </div>

        <!-- 用户状态显示 -->
        <div class="user-status">
            <h4>当前用户状态</h4>
            <p id="userStatusText">检查中...</p>
        </div>

        <!-- 收藏数量显示 -->
        <div class="favorites-count">
            <h4>收藏数据统计</h4>
            <p id="favoritesCountText">统计中...</p>
        </div>

        <!-- 收藏功能测试 -->
        <div class="test-section">
            <h2>🔖 收藏功能测试工具</h2>
            <div class="test-buttons">
                <button class="btn btn-success" onclick="simulateLogin()">模拟登录</button>
                <button class="btn btn-warning" onclick="simulateLogout()">模拟退出登录</button>
                <button class="btn btn-info" onclick="addTestFavorites()">添加测试收藏数据</button>
                <button class="btn btn-primary" onclick="checkFavoritesStatus()">检查收藏状态</button>
                <button class="btn btn-danger" onclick="clearAllFavorites()">清空所有收藏</button>
                <button class="test-btn" onclick="testFavoriteFunction()">测试收藏功能</button>
                <button class="test-btn" onclick="testPageNavigation()">测试页面跳转</button>
                <button class="test-btn" onclick="refreshCurrentPage()">刷新页面</button>
            </div>
            
            <div class="test-result">
                <h4>测试结果：</h4>
                <pre id="testResult">等待测试操作...</pre>
            </div>
        </div>

        <!-- 页面跳转测试 -->
        <div class="test-section">
            <h2>🔄 页面跳转测试</h2>
            <p>测试在不同页面间切换时收藏状态是否正确保持</p>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testPageNavigation()">开始页面跳转测试</button>
                <button class="btn btn-info" onclick="refreshCurrentPage()">刷新当前页面</button>
            </div>
        </div>

        <!-- 快速访问链接 -->
        <div class="quick-links">
            <a href="jingdian.html" class="quick-link">
                <h4>🏔️ 景点介绍</h4>
                <p>测试景点收藏功能</p>
            </a>
            <a href="meishi.html" class="quick-link">
                <h4>🍜 美食推荐</h4>
                <p>测试美食收藏功能</p>
            </a>
            <a href="wenhua.html" class="quick-link">
                <h4>🏛️ 汉文化活动</h4>
                <p>测试文化收藏功能</p>
            </a>
            <a href="index.html" class="quick-link">
                <h4>🏠 返回首页</h4>
                <p>回到网站首页</p>
            </a>
        </div>
    </div>

    <script src="js/common.js"></script>
    <script>
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateUserStatus();
            updateFavoritesCount();
            
            // 定期更新状态
            setInterval(() => {
                updateUserStatus();
                updateFavoritesCount();
            }, 2000);
        });

        // 更新用户状态显示
        function updateUserStatus() {
            const userData = getGlobalUserData();
            const statusText = document.getElementById('userStatusText');
            
            if (userData) {
                statusText.innerHTML = `
                    ✅ 已登录用户：${userData.username || userData.email || '未知用户'}<br>
                    登录时间：${userData.loginTime ? new Date(userData.loginTime).toLocaleString() : '未知'}
                `;
            } else {
                statusText.innerHTML = '❌ 未登录状态';
            }
        }

        // 更新收藏数量显示
        function updateFavoritesCount() {
            const favorites = JSON.parse(localStorage.getItem('hanzhong_favorites') || '[]');
            const countText = document.getElementById('favoritesCountText');
            
            const attractionCount = favorites.filter(fav => fav.type === 'attraction').length;
            const foodCount = favorites.filter(fav => fav.type === 'food').length;
            const cultureCount = favorites.filter(fav => fav.type === 'culture').length;
            
            countText.innerHTML = `
                总收藏数：${favorites.length} 项<br>
                景点：${attractionCount} 个 | 美食：${foodCount} 个 | 文化：${cultureCount} 个
            `;
        }

        // 模拟登录
        function simulateLogin() {
            const userData = {
                username: 'testuser',
                email: 'test@example.com',
                loginTime: new Date().toISOString()
            };
            
            localStorage.setItem('hanzhong_user', JSON.stringify(userData));
            updateTestResult('✅ 模拟登录成功！用户数据已保存。');
            updateUserStatus();
            
            // 更新所有收藏按钮状态
            if (typeof updateAllFavoriteButtonsStatus === 'function') {
                updateAllFavoriteButtonsStatus();
            }
        }

        // 模拟退出登录
        function simulateLogout() {
            // 调用全局退出登录函数
            if (typeof performLogout === 'function') {
                performLogout();
                updateTestResult('✅ 模拟退出登录成功！用户数据和收藏数据已清空。');
            } else {
                // 手动清理
                localStorage.removeItem('hanzhong_user');
                localStorage.removeItem('hanzhong_favorites');
                updateTestResult('✅ 手动退出登录成功！数据已清空。');
            }
            
            updateUserStatus();
            updateFavoritesCount();
        }

        // 添加测试收藏数据
        function addTestFavorites() {
            const testFavorites = [
                {
                    id: 'zhuyu-liyuan',
                    type: 'attraction',
                    title: '朱鹮梨园',
                    description: '世界朱鹮之乡，万亩梨花海洋',
                    image: 'img/zhuyu-liyuan.jpg',
                    rating: 4.8,
                    price: '￥60',
                    url: 'jingdian.html#attraction-zhuyu-liyuan',
                    addTime: new Date().toISOString()
                },
                {
                    id: 'remenpi',
                    type: 'food',
                    title: '汉中热面皮',
                    description: '汉中最具代表性的特色小吃',
                    image: 'img/remenpi.jpg',
                    rating: 4.9,
                    price: '￥5-8',
                    url: 'meishi.html#food-remenpi',
                    addTime: new Date().toISOString()
                },
                {
                    id: 'hanfu-experience',
                    type: 'culture',
                    title: '汉服文化体验',
                    description: '穿越时空，感受汉代服饰文化',
                    image: 'img/hanfu.jpg',
                    rating: 4.7,
                    price: '￥128',
                    url: 'wenhua.html#culture-hanfu-experience',
                    addTime: new Date().toISOString()
                }
            ];
            
            localStorage.setItem('hanzhong_favorites', JSON.stringify(testFavorites));
            updateTestResult('✅ 测试收藏数据添加成功！包含景点、美食、文化各1项。');
            updateFavoritesCount();
            
            // 更新按钮状态
            if (typeof updateAllFavoriteButtonsStatus === 'function') {
                updateAllFavoriteButtonsStatus();
            }
        }

        // 检查收藏状态
        function checkFavoritesStatus() {
            const favorites = JSON.parse(localStorage.getItem('hanzhong_favorites') || '[]');
            const userData = getGlobalUserData();
            
            let result = `收藏状态检查结果：\n`;
            result += `用户登录状态：${userData ? '已登录' : '未登录'}\n`;
            result += `收藏数据总数：${favorites.length}\n\n`;
            
            if (favorites.length > 0) {
                result += `收藏详情：\n`;
                favorites.forEach((fav, index) => {
                    result += `${index + 1}. [${fav.type}] ${fav.title}\n`;
                    result += `   添加时间：${new Date(fav.addTime).toLocaleString()}\n`;
                });
            } else {
                result += `暂无收藏数据\n`;
            }
            
            updateTestResult(result);
        }

        // 清空所有收藏
        function clearAllFavorites() {
            localStorage.removeItem('hanzhong_favorites');
            updateTestResult('✅ 所有收藏数据已清空！');
            updateFavoritesCount();
            
            // 更新按钮状态
            if (typeof updateAllFavoriteButtonsStatus === 'function') {
                updateAllFavoriteButtonsStatus();
            }
        }

        // 测试页面跳转
        function testPageNavigation() {
            updateTestResult('🔄 开始页面跳转测试...\n请手动访问各个页面，观察收藏按钮状态是否正确。');
        }

        // 刷新当前页面
        function refreshCurrentPage() {
            window.location.reload();
        }

        // 更新测试结果显示
        function updateTestResult(result) {
            document.getElementById('testResult').textContent = result;
        }

        // 测试收藏功能
        function testFavoriteFunction() {
            const userData = getGlobalUserData();
            if (!userData) {
                updateTestResult('❌ 请先模拟登录再测试收藏功能');
                return;
            }

            // 测试添加收藏
            const testItem = {
                id: 'test-item',
                type: 'attraction',
                title: '测试景点',
                description: '这是一个测试景点',
                image: 'img/default-image.jpg',
                rating: 4.5,
                price: '￥50',
                url: 'test.html',
                addTime: new Date().toISOString()
            };

            // 添加收藏
            let favorites = JSON.parse(localStorage.getItem('hanzhong_favorites') || '[]');
            
            // 检查是否已存在
            const existingIndex = favorites.findIndex(fav => fav.id === testItem.id && fav.type === testItem.type);
            
            if (existingIndex === -1) {
                favorites.push(testItem);
                localStorage.setItem('hanzhong_favorites', JSON.stringify(favorites));
                updateTestResult('✅ 收藏功能测试成功！已添加测试景点到收藏夹。\n\n现在可以点击收藏夹按钮查看收藏内容。');
            } else {
                // 移除测试项
                favorites.splice(existingIndex, 1);
                localStorage.setItem('hanzhong_favorites', JSON.stringify(favorites));
                updateTestResult('✅ 收藏功能测试成功！已移除测试景点。');
            }
            
            updateFavoritesCount();
            
            // 如果存在全局更新按钮状态的函数，则调用
            if (typeof updateAllFavoriteButtonsStatus === 'function') {
                updateAllFavoriteButtonsStatus();
            }
        }

        // 获取用户数据的兼容函数
        function getGlobalUserData() {
            if (typeof window.getGlobalUserData === 'function') {
                return window.getGlobalUserData();
            }
            
            try {
                const userData = localStorage.getItem('hanzhong_user');
                return userData ? JSON.parse(userData) : null;
            } catch (e) {
                return null;
            }
        }
    </script>
</body>
</html> 